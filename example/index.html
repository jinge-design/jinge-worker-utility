<!DOCTYPE html>
<html>
  <head>
    <title>test</title>
    <base href="/dist/"/>
  </head>
  <body>
    <script src="jinge-worker-utility.min.js"></script>
    <script>
      (async () => {
        // console.log(await JingeWorkerUtility.hello('world'));
        await JingeWorkerUtility.bsonEncode(0);

        // let _st = Date.now();
        const bsonResult = await JingeWorkerUtility.bsonEncode({
          name: 'jinge',
          age: 18,
          body: new Array(100).fill(0).map((n, i) => `${i}: 'hello, world! 你好，世界！'`)
        });
        // console.log(Date.now() - _st);
        console.log(bsonResult);

        const link = document.createElement( 'a' );
        link.style.display = 'none';
        document.body.appendChild( link );


        const blob = new Blob( [ bsonResult.buffer ], { type: 'application/oct-stream' } );	
        const objectURL = URL.createObjectURL( blob );
        
        link.href = objectURL;
        link.href = URL.createObjectURL( blob );
        link.download =  'data.bin';
        link.click();
  
        // _st = Date.now();
        const json = await JingeWorkerUtility.bsonDecode(bsonResult);
        // console.log(Date.now() - _st);
        console.log(json);

      })().catch(err => {
        console.error(err);
      });
    </script>
  </body>
</html>